(function(u,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("@preact/signals"),require("preact"),require("hls.js")):typeof define=="function"&&define.amd?define(["exports","@preact/signals","preact","hls.js"],s):(u=typeof globalThis<"u"?globalThis:u||self,s(u["preact-ts-hls-player"]={},u["@preact/signals"],u.preact,u.hls.js))})(this,function(u,s,l,m){"use strict";var O=Object.defineProperty;var L=(u,s,l)=>s in u?O(u,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[s]=l;var p=(u,s,l)=>L(u,typeof s!="symbol"?s+"":s,l);var h,r,v,g,y=0,E=[],_=l.options,P=_.__b,T=_.__r,k=_.diffed,j=_.__c,w=_.unmount,A=_.__;function b(t,e){_.__h&&_.__h(r,t,y||e),y=0;var i=r.__H||(r.__H={__:[],__h:[]});return t>=i.__.length&&i.__.push({}),i.__[t]}function q(t,e){var i=b(h++,3);!_.__s&&N(i.__H,e)&&(i.__=t,i.i=e,r.__H.__h.push(i))}function V(t){return y=5,C(function(){return{current:t}},[])}function C(t,e){var i=b(h++,7);return N(i.__H,e)&&(i.__=t(),i.__H=e,i.__h=t),i.__}function F(){for(var t;t=E.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(f),t.__H.__h.forEach(H),t.__H.__h=[]}catch(e){t.__H.__h=[],_.__e(e,t.__v)}}_.__b=function(t){r=null,P&&P(t)},_.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),A&&A(t,e)},_.__r=function(t){T&&T(t),h=0;var e=(r=t.__c).__H;e&&(v===r?(e.__h=[],r.__h=[],e.__.forEach(function(i){i.__N&&(i.__=i.__N),i.i=i.__N=void 0})):(e.__h.forEach(f),e.__h.forEach(H),e.__h=[],h=0)),v=r},_.diffed=function(t){k&&k(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(E.push(e)!==1&&g===_.requestAnimationFrame||((g=_.requestAnimationFrame)||z)(F)),e.__H.__.forEach(function(i){i.i&&(i.__H=i.i),i.i=void 0})),v=r=null},_.__c=function(t,e){e.some(function(i){try{i.__h.forEach(f),i.__h=i.__h.filter(function(a){return!a.__||H(a)})}catch(a){e.some(function(o){o.__h&&(o.__h=[])}),e=[],_.__e(a,i.__v)}}),j&&j(t,e)},_.unmount=function(t){w&&w(t);var e,i=t.__c;i&&i.__H&&(i.__H.__.forEach(function(a){try{f(a)}catch(o){e=o}}),i.__H=void 0,e&&_.__e(e,i.__v))};var D=typeof requestAnimationFrame=="function";function z(t){var e,i=function(){clearTimeout(a),D&&cancelAnimationFrame(e),setTimeout(t)},a=setTimeout(i,100);D&&(e=requestAnimationFrame(i))}function f(t){var e=r,i=t.__c;typeof i=="function"&&(t.__c=void 0,i()),r=e}function H(t){var e=r;t.__c=t.__(),r=e}function N(t,e){return!t||t.length!==e.length||e.some(function(i,a){return i!==t[a]})}class S{constructor(e){p(this,"audio");p(this,"hls",null);p(this,"hlsNative",!1);this.audio=(e==null?void 0:e.audioTag)??new Audio,this.initializeHls()}initializeHls(){this.audio&&(m.isSupported()?(this.hls=new m,this.hls.attachMedia(this.audio)):this.audio.canPlayType("application/vnd.apple.mpegurl")&&(this.hlsNative=!0))}load(e){var i;this.hlsNative?this.audio.src=e:(i=this.hls)==null||i.loadSource(e)}play(){this.audio.play()}pause(){this.audio.pause()}togglePlayPause(){this.isPlaying()?this.pause():this.play()}isPlaying(){return!this.audio.paused}stop(){this.audio.pause()}getDuration(){return this.audio.duration||0}seek(e){return this.audio.currentTime=e}getPosition(){return this.audio.currentTime}getVolume(){return this.audio.volume}setVolume(e){e>=0&&e<=1?this.audio.volume=e:console.warn("Volume value must be between 0.0 and 1.0")}on(e){const i=this;return{do(a){var o;(o=i.hls)==null||o.on(m.Events[e],a)}}}destroy(){var e;(e=this.hls)==null||e.destroy(),this.hls=null,this.audio.pause(),this.audio=null}}const n=new S,M=()=>{const t=s.useSignal(n.isPlaying()),e=s.useSignal(n.getVolume()),i=V();return q(()=>(i.current=window.setTimeout(()=>n.setVolume(e.value),100),()=>clearTimeout(i.current)),[e.value]),q(()=>{const o=n.audio;if(!o)return;const d={play:()=>{t.value=!0},pause:()=>{t.value=!1},ended:()=>{t.value=!1}};return Object.keys(d).forEach(c=>o.addEventListener(c,d[c])),()=>{Object.keys(d).forEach(c=>o.removeEventListener(c,d[c]))}},[n.audio]),{controller:n,playing:t,volume:e,load:o=>{n.load(o.url),o.on&&n.on("MEDIA_ENDED").do(o.on.end)},setVolume:o=>e.value=o,seek:o=>n.seek(o),stop:()=>n.stop(),play:()=>n.play(),pause:()=>n.pause(),togglePlayPause:()=>n.togglePlayPause(),getDuration:()=>n.getDuration(),getPosition:()=>n.getPosition()}};u.HlsAudioController=S,u.useHlsController=M,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
